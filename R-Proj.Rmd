---
title: "R Project"
output:
  html_document:
    df_print: paged
  html_notebook: default
  pdf_document: default
---
# INSTALLING REQUIRED PACKAGES
```{r}
install.packages("tidyverse")
install.packages("dplyr")
install.packages("plotly")
install.packages("gganimate")
install.packages("knitr")
install.packages("gridExtra")
install.packages("data.table")
install.packages("shiny")
install.packages("rsconnect")

```
# LOADING REQUIRED LIBRARIES
```{r}
library(tidyverse)
library(plotly)
library(ggplot2)
library(gganimate)
library(purrr)
library(data.table)
library(knitr)
library(dplyr)
library(gridExtra)
library(png)
library(gifski)
library(rsconnect)

```
# LOAD ATHLETES EVENTS DATA
```{r}
athletes = read.csv("athlete_events.csv", stringsAsFactors = F)
col_types = cols(
                   ID = col_character(),
                   Name = col_character(),
                   Sex = col_factor(levels = c("M","F")),
                   Age =  col_integer(),
                   Height = col_double(),
                   Weight = col_double(),
                   Team = col_character(),
                   NOC = col_character(),
                   Games = col_character(),
                   Year = col_number(),
                   Season = col_factor(levels = c("Summer","Winter")),
                   City = col_character(),
                   Sport = col_character(),
                   Event = col_character(),
                   Medal = col_factor(levels = c("Gold","Silver","Bronze"))
                 )

glimpse(athletes)
head(athletes)


```
# LOAD DATA MATCHING NOCs (NATIONAL OLYMPIC COMMITTEE) WITH COUNTRIES
```{r}
NOCs <- read_csv("noc_regions.csv", col_types = cols(
                  NOC = col_character(),
                  region = col_character()
                ))
glimpse(NOCs)
head(NOCs)
```
## Clearing Data by removing NAs from "Medal" Column
```{r}
cleared_data = athletes %>%
  filter(Medal != "<NA>") ## retain all data which is not NA
cleared_data$Year =as.factor(cleared_data$Year)
head(cleared_data)
```

## Medals won by Pakistan
```{r}
medalsbyPak = subset(cleared_data, Team == "Pakistan")
head(medalsbyPak)
```

## Medals won by each country
```{r}
countrywiseMEDALS = cleared_data %>% group_by(Team) %>% summarise(Medals = length(Medal)) %>% arrange(desc(Medals))
head(countrywiseMEDALS)
```
## top ten Medals wining countries
```{r}
countrywiseMEDALS %>% top_n(10) %>% ggplot(aes(x =Medals, y= Team))+
  geom_bar(stat = 'identity', colour="white", fill="red")+theme_dark()
```  
## Medals by countries per year
```{r}
peryearMedals = cleared_data %>% 
  group_by(Team, Year) %>%
  summarise(Total = n())
head(peryearMedals)

```
## Medals by selected countries per year
```{r}
medalsbyselectedCOUNTRIES = peryearMedals %>% filter(Team %in% c("USA", "Russia", "China", "Germany", "France"))
head(medalsbyselectedCOUNTRIES)

```
## ploting medals data by selected countries
```{r}
medalsbyselectedCOUNTRIES %>% ggplot(aes(x = Year, y = Total, group = Team))+geom_line(aes(color = Team))+geom_point(aes(color = Team)) + theme_classic()+theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
## Seasonnwise (Summer - Winter) Medals by all countries
```{r}
Seasonnwise = cleared_data %>% group_by(Team, Season) %>%
  summarise(Medals_by_season = length(Medal)) %>%
  arrange (desc(Medals_by_season))

```
## Seasonnwise (Summer - Winter) Medals for China, USA, Russia, France & Germany
```{r}
Seasonnwise_g5 = Seasonnwise %>% filter(Team %in% c("China", "Russia","USA","France","Germany"))
Seasonnwise_g5 %>% ggplot(aes(x = Team, y = Medals_by_season, fill = Season)) +
  geom_bar(stat = "identity", position = position_dodge())+theme_light(
  )
```
## Men Vs Women Performance in the olympics
```{r}
performance = cleared_data %>% group_by(Year, Season, Sex) %>%
dplyr::summarise(Count=n()) %>%
  arrange(Year)
 
performance %>% ggplot(aes(x=Year, y=Count, group=Sex)) +
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
  
```
## Men Vs Women Performance in the olympics in Summer 
```{r}
performance = cleared_data %>% group_by(Year, Season, Sex) %>%
 filter(Season == 'Summer') %>%
dplyr::summarise(Count=n()) %>%
  arrange(Year)
  
performance %>% ggplot(aes(x=Year, y=Count, group=Sex)) +
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```
## Men Vs Women Performance of top 10 in the olympics
```{r}
performance = cleared_data %>% group_by(Year, Season, Sex) %>%
top_n(10, Team) %>%
dplyr::summarise(Count=n()) %>%
  arrange(Year)
  
##view(performance)

performance %>% ggplot(aes(x=Year, y=Count, group=Sex)) +
  geom_line(aes(color=Sex))+
  geom_point(aes(color=Sex))+
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
  
```
## Most Popular sports by Gender
```{r}
popularsportsbygender = cleared_data %>% group_by(Sport, Sex) %>%
  filter(Season =='Summer') %>%
  summarize(Count=n()) %>%
  group_by(Sex) %>% top_n(10, Sport)

ggplot(popularsportsbygender, aes(x=Sport, y=Count, group=Sex))+
  geom_col(aes(fill=Sex))+
  theme(axis.text.x = element_text(angle = 90, hjust =1))
```
## Medals won by women in 2016
```{r}
m_2016 = cleared_data %>% filter( Year==2016, Sex=="F") %>%
  group_by(NOC, Medal) %>%
  summarize(Count=length(Medal))
head(m_2016)

ggplot(m_2016, aes(x=NOC, y=Count, fill=Medal))+
  geom_col()+
  coord_flip()+
  scale_fill_manual(values=c("Gold1", "Gray70", "Gold4")) + 
  ggtitle("Medal Counts for women at the 2016 Olympics") +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text.y = element_text(size = 3))
```
```{r}
## Number of athletes participated
athletesnumbers <- cleared_data %>%
  group_by(Year, Sex) %>%
  summarize(count=n())

athletesnumbers %>% ggplot(aes(x=Year, y=count, fill=Sex))+
  geom_col()+
  coord_flip()+
  ggtitle("Genderwise Athletes participated") +
  theme(plot.title = element_text(hjust = 0.5),
  axis.text.y = element_text(size = 6))
```
##PARTICIPATION OF MALE AND FEMALE ATHLETES OVER TIME, WITHOUT ART COPETITIONS
```{r}

dataOlympics <- athletes %>% 
  filter(Sport != "Art Competitions")
# AFTER 1992, CHANGE THE YEAR OF THE WINTER GAMES TO COINCIDE WITH THE NEXT SUMMER GAMES. THE TERM "YEAR" CURRENTLY REFERS TO THE OLYMPICS TOOK PLACE
original <- c(1994,1998,2002,2006,2010,2014)
new <- c(1996,2000,2004,2008,2012,2016)
for (i in 1:length(original)) {
  dataOlympics$Year <- gsub(original[i], new[i], dataOlympics$Year)
}
dataOlympics$Year <- as.integer(dataOlympics$Year)
# COUNT NUMBER OF ATHLETES BY SEX AND YEAR
countsSex <- dataOlympics %>% 
  group_by(Year, Sex) %>%
  summarize(Athletes = length(unique(ID)))
countsSex$Year <- as.integer(countsSex$Year)
# PLOT MALE AND FEMALE ATHLETES OVER TIME
ggplot(countsSex, aes(x=Year, y=Athletes, group=Sex, color=Sex)) +
  geom_point(size=2) +
  geom_line()  +
  transition_reveal(Year)+
  scale_color_manual(values=c("deepskyblue4","red4")) +
  labs(x = "Year", y = "Athletes", 
       title="Male and Female athletes over time", 
       subtitle = "Olympic Games from 1896 to 2016")

```

## Has the number of athletes, countries, and events increased or decreased throughout time?
```{r}
numbers <- cleared_data %>%
  group_by(Year, Season) %>%
  summarize(Nations = length(unique(NOC)), Athletes = length(unique(ID)), Events = length(unique(Event))
  )

plotNations <- ggplot(numbers, aes(x=Year, y=Nations, group=Season, color=Season)) +
  geom_point() +
  geom_line() +
  labs(x = " ", y = "Nations", 
       title="Nations, Athletes and Events", 
       subtitle = "Olympic Games from 1896 to 2016")+
  theme(axis.text.x = element_text(size = 5))
plotAthletes <- ggplot(numbers, aes(x=Year, y=Athletes, group=Season, color=Season)) +
  geom_point() +
  geom_line() +
  xlab("")+
  theme(axis.text.x = element_text(size = 5))
plotEvents <- ggplot(numbers, aes(x=Year, y=Events, group=Season, color=Season)) +
  geom_point() +
  geom_line() +
  theme(axis.text.x = element_text(size = 5)) 
grid.arrange(plotNations, plotAthletes, plotEvents, nrow=3)
``` 
## Most Medels winning nations
```{r}
medalCounts <- cleared_data %>% filter(!is.na(Medal))%>% 
  group_by(NOC, Medal, Event, Games) %>%
  summarize(isMedal=1)
medalCounts <-  medalCounts %>% 
  group_by(NOC, Medal) %>%
  summarize(Count= sum(isMedal))
medalCounts <- left_join(medalCounts, NOCs, by= "NOC" )
medalCounts <- medalCounts %>% 
  mutate (Team = region)
medalCounts <- medalCounts %>% select( Medal, Team, Count)


# ORDERING TEAM BY TOTAL MEDAL COUNT
levelsTeam <- medalCounts %>%
  group_by(Team) %>%
  summarize(Total=sum(Count)) %>%
  arrange(desc(Total)) %>%
  select(Team) %>%
  slice(10:1)
medalCounts$Team <- factor(medalCounts$Team, levels=levelsTeam$Team)
medalCounts <- medalCounts %>% filter(Team != "NA")
# PLOT MEDAL COUNTS
ggplot(medalCounts, aes(x=Team, y=Count, fill=Medal)) +
  geom_col() +
  coord_flip() +
  scale_fill_manual(values=c("gold3","gray64","sienna")) +
  labs(x = "Nations", y = "Count", 
       title="Top 10 - Nations with the most medals won in history", 
       subtitle = "Olympic Games from 1896 to 2016")

```
## Animated graph showing 
```{r}
medalCounts <- cleared_data %>% filter(!is.na(Medal))%>% 
  group_by(NOC, Medal, Event, Games, Year) %>%
  summarize(isMedal=1)
medalCounts <-  medalCounts %>% 
  group_by(NOC, Medal, Year) %>%
  summarize(Count= sum(isMedal))
medalCounts <- left_join(medalCounts, NOCs, by= "NOC" )
medalCounts <- medalCounts %>% 
  mutate (Team = region)
medalCounts <- medalCounts %>% select( Medal, Team, Count, Year)

# ORDERING TEAM BY TOTAL MEDAL COUNT
levelsTeam <- medalCounts %>%
  group_by(Team) %>%
  summarize(Total=sum(Count)) %>%
  arrange(desc(Total)) %>%
  select(Team) %>%
  slice(10:1)
medalCounts$Team <- factor(medalCounts$Team, levels=levelsTeam$Team)
medalCounts <- medalCounts %>% filter(Team != "NA")

# ANIMATED PLOT MEDAL COUNT
plotMedalsAnim<- ggplot(medalCounts, aes(x=Team, y=Count, fill=Medal)) +
  labs(x = "Nations", y = "Count", 
       title='Top 10 - Comparison over time, nations with the most medals', 
       subtitle = 'Olympic Games from 1896 to 2016 - Year: {closest_state}')  +
  transition_states(Year)+
  geom_col() +
  coord_flip() +
  scale_fill_manual(values=c("gold3","gray64","sienna"))
animate(plotMedalsAnim,fps=2)
```
##View the map to see which countries won the most medals
```{r}
medalCounts <- athletes %>% filter(!is.na(Medal))%>% 
  group_by(NOC, Medal, Event, Games) %>%
  summarize(isMedal=1)
medalCounts <-  medalCounts %>% 
  group_by(NOC, Medal) %>%
  summarize(Count= sum(isMedal))
medalCounts <- left_join(medalCounts, NOCs, by= "NOC" ) %>% 
  select(region, NOC, Medal, Count)
medalCounts <- medalCounts %>%
  group_by(region) %>%
  summarize(Total=sum(Count))
data_regions <- medalCounts %>% 
  left_join(NOCs,by="region") %>%
  filter(!is.na(region))
earth <- map_data("world")
earth <- left_join(earth, data_regions, by="region")
# PLOT MAP
plotMapMedals <- ggplot(earth, aes(x = long, y = lat, group = group)) +
  geom_polygon(aes(fill = Total, label= region)) +
  labs(x = "", y = "", 
       title="Map of nations with the most medals won", 
       subtitle = "Olympic Games from 1896 to 2016") +
  guides(fill=guide_colourbar(title="medals")) +
  scale_fill_gradient(low="white",high="gold3")
plotMapMedals
ggplotly(plotMapMedals)

```